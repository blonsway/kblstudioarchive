<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
	<h1>This is a timeline.</h1>

	<p id="placeholder"></p>
	

	<script type="text/javascript">
		
		var svgWidth = 800;
		var svgHeight = 200;

		var startYear = 1990;
		var endYear = 2023;

		var timelinesvg = d3.select("body")
			.append("svg")
			.attr("width", svgWidth)
			.attr("height", svgHeight); 

		d3.json("https://archive.kblstudio.com/wp-json/wp/v2/world-event", getYears);


		function getYears (data) {

			//sort post array on year
			var sortedData = data.slice().sort((a,b) => d3.ascending(a['toolset-meta']['world-event-fields'].year.raw, b['toolset-meta']['world-event-fields'].year.raw));			
			
			// d3.select("#placeholder")
			// 	.selectAll("div")
			// 	.data(sortedData)
			// 	.enter()
			// 	.append("div")
			// 	.style("width","300px")
			// 	.style("margin","20px")
			// 	.style("background-color","#bbb")
			// 	.text( function (d) {return d['toolset-meta']['world-event-fields'].year.raw}); 

			// create scale for years based on start year and end year
			var timeScaleYears = d3.scaleTime()
				.domain([startYear, endYear])
				.range([0,svgWidth])
				.nice();

			//create x axis
			var xAxis = d3.axisBottom(timeScaleYears)
				.ticks(endYear-startYear)
				.tickFormat(d3.format("d"));
		
			timelinesvg.selectAll("points")
				.data(sortedData)
				.enter()
				.append("circle")
					.attr("fill","#fc3")
					.attr("stroke", "none")
					.attr("cx", function(d) {return timeScaleYears(d['toolset-meta']['world-event-fields'].year.raw);})
					.attr("cy", 100)
					.attr("r", 5);

			timelinesvg.selectAll("points")
				.data(sortedData)
				.enter()
				.append("text")
					.attr("x", function(d) {return timeScaleYears(d['toolset-meta']['world-event-fields'].year.raw);})
					.attr("y", 110)
					.attr("dy", ".3em")
					.text(function(d) {return (d.title.rendered);})
				;

			timelinesvg.append("g")
				.attr("transform", "translate(0,"+(svgHeight-20)+")")
				.call(xAxis)
				.selectAll("text")
				.attr("transform","rotate(-90)");


		}


	</script>
</body>
</html>
