<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<body>
	<h1>This is a timeline.</h1>

	<p id="placeholder"></p>
	

	<script type="text/javascript">
		
		var svgWidth = 800;
		var svgHeight = 200;

		var timelinesvg = d3.select("body")
			.append("svg")
			.attr("width", svgWidth)
			.attr("height", svgHeight); 

		d3.json("https://archive.kblstudio.com/wp-json/wp/v2/world-event", getYears);
			// function (data) {

			// 	d3.selectAll("p")
			// 	.data(data)
			// 	.enter()
			// 	.append("p")
			// 	.text(function (d) {
			// 		return d['toolset-meta']['world-event-fields'].year.raw;
			// 	}); 
			// });

		function getYears (data) {

			var sortedData = data.slice().sort((a,b) => d3.ascending(a['toolset-meta']['world-event-fields'].year.raw, b['toolset-meta']['world-event-fields'].year.raw));			
			
			d3.select("#placeholder")
				.selectAll("div")
				.data(sortedData)
				.enter()
				.append("div")
				.style("width","300px")
				.style("margin","20px")
				.style("background-color","#bbb")
				.text( function (d) {return d['toolset-meta']['world-event-fields'].year.raw}); 

			console.log([sortedData[0]['toolset-meta']['world-event-fields'].year.raw]);
			console.log([sortedData[1]['toolset-meta']['world-event-fields'].year.raw]);

			var timeScaleYears = d3.scaleTime()
				.domain([[sortedData[0]['toolset-meta']['world-event-fields'].year.raw],[sortedData[1]['toolset-meta']['world-event-fields'].year.raw]])
				.range([0,svgWidth])
				.nice();

			var xAxis = d3.axisBottom(timeScaleYears)
				.ticks(16)
				.tickFormat(d3.format("d"));
		
			timelinesvg.append("g")
				.call(xAxis);

			timelinesvg.selectAll("points")
				.data(sortedData)
				.enter()
				.append("circle")
					.attr("fill","#fc9")
					.attr("stroke", "none")
					.attr("cx", function(d) {return timeScaleYears(d['toolset-meta']['world-event-fields'].year.raw);})
					.attr("cy", 100)
					.attr("r", 3);
		}


	</script>
</body>
</html>
